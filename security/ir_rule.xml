<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- Assign XML ID to existing Sales/Agents group -->
        <record id="group_sales_agents" model="res.groups">
            <field name="name">Agents</field>
            <!-- Category should match Sales -->
            <field name="category_id" ref="base.module_category_sales_sales"/>
        </record>
        
        <!-- Record rule to restrict agents from seeing channels with other agents -->
        <record id="discuss_channel_agents_restrict_rule" model="ir.rule">
            <field name="name">Agents: Cannot Access Channels With Other Agents</field>
            <field name="model_id" ref="mail.model_discuss_channel"/>
            <field name="groups" eval="[(4, ref('restrict_agent_chat.group_sales_agents'))]"/>
            <field name="domain_force">[
                '|',
                    ('channel_member_ids.partner_id', '=', user.partner_id.id),
                    '!',
                    ('channel_member_ids.partner_id.user_ids.groups_id', 'in', [ref('restrict_agent_chat.group_sales_agents')])
            ]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Additional rule for mail messages -->
        <record id="mail_message_agents_restrict_rule" model="ir.rule">
            <field name="name">Agents: Cannot Read Messages in Agent-Only Channels</field>
            <field name="model_id" ref="mail.model_mail_message"/>
            <field name="groups" eval="[(4, ref('restrict_agent_chat.group_sales_agents'))]"/>
            <field name="domain_force">[
                '|',
                    ('model', '!=', 'discuss.channel'),
                    ('res_id', 'in', [c.id for c in user.partner_id.channel_ids])
            ]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
    </data>
</odoo>